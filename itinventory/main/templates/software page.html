{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta required name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link rel="shortcut icon" href="{% static 'img/icons/icon-48x48.png' %}" />

	<link rel="canonical" href="https://demo-basic.adminkit.io/pages-blank.html" />

	<title>IT Inventory System</title>

	<link href="{% static 'css/app.css' %}" rel="stylesheet">
	<link href="{% static 'css/modalform.css' %}" rel="stylesheet">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
</head>

<body>
	<div class="wrapper">
		<nav id="sidebar" class="sidebar js-sidebar">
			<div class="sidebar-content js-simplebar">
				<a class="sidebar-brand" href="{% url 'dashboard' %}">
					<span class="align-middle">IT Inventory System</span>
				</a>
				<div style="{{Style}}">
				<li class="sidebar-header">
					Administrator Page
				</li>
		
			<li class="sidebar-item">
				<a class="sidebar-link" href="{% url 'admin:index' %}">
	  <i class="align-middle" data-feather="sliders"></i> <span class="align-middle">Go to Admin </span>
	</a>
			</li>
		</div>
		<li class="sidebar-header">
			Loan
		</li>


		<li class="sidebar-item">
			<a class="sidebar-link" href="{% url 'loanpage' %}">
  <i class="align-middle" data-feather="sliders"></i> <span class="align-middle">Loan Detail</span>
</a>
		</li>
		
		
						<li class="sidebar-header">
								Computer
							</li>
		
							<li class="sidebar-item">
								<a class="sidebar-link" href="{% url 'computerpage' %}">
					  <i class="align-middle" data-feather="sliders"></i> <span class="align-middle">Computer Details</span>
					</a>
							</li>
		
				
		
						
							<li class="sidebar-header">
								Laptop
							</li>
		
							<li class="sidebar-item">
								<a class="sidebar-link" href="{% url 'laptoppage' %}">
					  <i class="align-middle" data-feather="sliders"></i> <span class="align-middle">Laptop Detail</span>
					</a>
							</li>
		
				
		
					
							<li class="sidebar-header">
								Other
							</li>
		
							<li class="sidebar-item">
								<a class="sidebar-link" href="{% url 'Networkhardwarepage' %}">
					  <i class="align-middle" data-feather="sliders"></i> <span class="align-middle">Network Hardware Detail</span>
					</a>
							</li>
		
							<li class="sidebar-header">
								IP
							</li>
		
							<li class="sidebar-item">
								<a class="sidebar-link" href="{% url 'ippage' %}">
					  <i class="align-middle" data-feather="sliders"></i> <span class="align-middle">IP Detail</span>
					</a>
							</li>
		
							
							<li class="sidebar-header">
								User
							</li>
		
							<li class="sidebar-item">
								<a class="sidebar-link" href="{% url 'userpage' %}">
					  <i class="align-middle" data-feather="sliders"></i> <span class="align-middle">User Detail</span>
					</a>
							</li>
							
							<li class="sidebar-header">
								software
							</li>
			
		
							<li class="sidebar-item">
								<a class="sidebar-link" href="{% url 'software' %}">
					  <i class="align-middle" data-feather="sliders"></i> <span class="align-middle">software User</span>
					</a>
							</li>
							<div style="{{Style}}">
								<li class="sidebar-header">
									Upload Page
								</li>
						
							<li class="sidebar-item">
								<a class="sidebar-link" href="{% url 'uploadcsvdata' %}">
					  <i class="align-middle" data-feather="sliders"></i> <span class="align-middle">Upload Page </span>
					</a>
							</li>
						</div>
			
		
		
					
					</div>
				</nav>

		<div class="main">
			<nav class="navbar navbar-expand navbar-light navbar-bg">
				<a class="sidebar-toggle js-sidebar-toggle">
          <i class="hamburger align-self-center"></i>
        </a>

				<div class="navbar-collapse collapse">
					<ul class="navbar-nav navbar-align">
					
						<li class="nav-item dropdown">
							<a class="nav-icon dropdown-toggle d-inline-block d-sm-none" href="#" data-bs-toggle="dropdown">
                <i class="align-middle" data-feather="settings"></i>
              </a>

							<a class="nav-link dropdown-toggle d-none d-sm-inline-block" href="#" data-bs-toggle="dropdown">
                 <span class="text-dark">{{Username}}</span>
              </a>
			 
							<div class="dropdown-menu dropdown-menu-end">
								<div style="{{Style}}">
								<a class="dropdown-item" href="{% url 'historypage' %}"><i class="align-middle me-1" data-feather="user"></i> History</a>
							</div>
								<div class="dropdown-divider"></div>
								<a class="dropdown-item" href="{% url 'logoutsystem' %}">Log out</a>
							</div>
						</li>
					</ul>
				</div>
			</nav>

			<main class="content">
				<div class="container-fluid p-0">

					<h1 class="h3 mb-3">Software List</h1>
                   
					<div class="row">
						<div class="col-12">
							<div class="card">
								<div class="card-header">
									<div class="d-flex justify-content-around">
										<button id="Add" onclick="openform()" class="btn btn-primary">Add Software User</button>

	
										<select name="softwarefilter" id="softwarefilter" onchange="fitertable()">
											<option value="default">Please chose the Software name</option>
										</select>
											
											<button id="export" onclick="openexport()" class="btn btn-primary">export data</button>
										</div>
										<br>
									
                                 
                                    <div class="table-responsive " style="height: 500px;">
                                        <table class="table limittablesize" id="softwareuser">
                                            <thead class="table-dark" id="computer-list">
                                              <tr>
												
                                                <th scope="col">Software Type</th>
												<th scope="col">Software Name</th>
												<th scope="col">User Type</th>
                                                <th scope="col">Employee Number</th>
                                                <th scope="col">Software Version</th>
												<th scope="col">Update</th>
                                                <th scope="col">Delete</th>
												
                                                
                                              </tr>
                                            </thead>
                                            <tbody id="trtable">
											
											

                                            
                                              
                                            </tbody>
                                          </table>
                                        </div>
								</div>
								<div class="card-body">
								</div>
							</div>
						</div>
					</div>

				</div>
			</main>

			<footer class="footer">
			
			</footer>
		</div>
	</div>
	<!-- The Modal -->
<div id="addform" class="modalform">

	<!-- Modal content -->
	<div class="modalform-header">
	  <span onclick="closeform()" class="closeform">&times;</span>
	 <h1 class="text-center">Add Software User</h1>
	</div>
	<div class="modalform-content">
		<form method="POST" class="post-form" id="add-IP" onsubmit="AddSoftwareUser(); return false">  
		
				{% csrf_token %}
			   
            
                     <h3 class="text-center" style=" color: #564953;">User Software Details</h3>
    
                     <div class="form-group row">
                        <label for="inputEmail3" class="col-sm-2 col-form-label">Software Type:</label>
                        <div class="col-sm-3">
                            <select  class="form-control" required name="Software_Type" id="Software_Type" onchange="listsoftware()">
                                <option value="Default">Default</option>
                                <option value="Concurrent">Concurrent</option>
                                <option value="Non-Concurrent">Non-Concurrent</option>
    
                            </select>
                        </div>
                        
                       
                        <label for="inputEmail3" class="col-sm-2 col-form-label">Software Name :</label>
                        <div class="col-sm-3">
                            <select  class="form-control" required name="Software_Name" id="Software_Name" onchange=" listsoftwareVersion()">
                                <option value="Default">Default</option>
                            </select>
                        </div>
                      </div>
                     <br>
                     <div class="form-group row">
                        <label for="inputEmail3" class="col-sm-2 col-form-label">User Type  :</label>
                        <br><br>
                        <div class="col-sm-3">
                            <div class="form-check-inline">
                                <input class="form-check-input" type="radio" required name="User_type" id="User_type_machine" value="Machine">
                                <label class="form-check-label" for="inlineRadio1">Machine</label>
                              </div>
                              <div class="form-check-inline">
                                <input class="form-check-input" type="radio" required name="User_type" id="User_type_worker" value="Worker">
                                <label class="form-check-label" for="inlineRadio2">Worker</label>
                              </div>
                         
                        </div>
                       
                          <label for="inputEmail3" class="col-sm-2 col-form-label">User ID :</label>
     
                       
                        <div class="col-sm-3">
                          <input type="text" list="addsearchresult" class="form-control" required name="User_ID" id="User_ID" onkeyup="showResult(this.value)">
						  <div id="searchIDresult"></div>
                        </div>
                      </div>
                      <br>
                      <div class="form-group row">
                        <label for="inputEmail3" class="col-sm-2 col-form-label">Software Version  :</label>
                        <br><br>
                        <div class="col-sm-3">
                            <select  class="form-control" name="Software_Version" id="Software_Version">
                                <option value="Default">Default</option>
                            </select>
                         
                        </div>
                       
                      </div>
                    
                    
                      
                   <br>
                  
				
				 
				  <div class="text-center">
					<input type="submit" value="Submit" class="btn btn-primary" >
	
				   </div>
				</form>
	</div>
	<div class="modalform-footer">
		
	</div>
  
  </div>
  <datalist id="addsearchresult">

  </datalist>
<div id="updateformmodal" class="modalform">

	<!-- Modal content -->
	<div class="modalform-header">
	  <span onclick="closeformupdate()" class="closeform">&times;</span>
	 <h1 class="text-center">Update User Software</h1>
	</div>
	<div class="modalform-content">
		<form method="POST" class="post-form" id="update-computer" onsubmit="UpdatesoftwareUser(); return false">  
		
			{% csrf_token %}
			<div style="display:none">
				<input type="text" class="form-control" required name="update_user_pk" id="update_user_pk">
			</div>
				 <h3 class="text-center" style=" color: #564953;">User Software Details</h3>

				 <div class="form-group row">
					<label for="inputEmail3" class="col-sm-2 col-form-label">Software Type:</label>
					<div class="col-sm-3">
						<select  class="form-control" required name="Update_Software_Type" id="Update_Software_Type" onchange="Updatelistsoftware()">
                            <option value="Default">Default</option>
                            <option value="Concurrent">Concurrent</option>
                            <option value="Non-Concurrent">Non-Concurrent</option>

                        </select>
					</div>
					
				   
					<label for="inputEmail3" class="col-sm-2 col-form-label">Software Name :</label>
					<div class="col-sm-3">
						<select  class="form-control" required name="Update_Software_Name" id="Update_Software_Name" onchange="UpdatelistsoftwareVersion()" >
                            <option value="Default">Default</option>
                        </select>
					</div>
				  </div>
				 <br>
				 <div class="form-group row">
					<label for="inputEmail3" class="col-sm-2 col-form-label">User Type  :</label>
					<br><br>
					<div class="col-sm-3">
						<div class="form-check-inline">
							<input class="form-check-input" type="radio" required name="Update_User_type" id="Update_User_type_machine" value="Machine">
							<label class="form-check-label" for="inlineRadio1">Machine</label>
						  </div>
						  <div class="form-check-inline">
							<input class="form-check-input" type="radio" required name="Update_User_type" id="Update_User_type_worker" value="Worker">
							<label class="form-check-label" for="inlineRadio2">Worker</label>
						  </div>
					 
					</div>
				   
					  <label for="inputEmail3" class="col-sm-2 col-form-label">User ID :</label>
 
				   
					<div class="col-sm-3">
					  <input type="text" class="form-control" required name="Update_User_ID" id="Update_User_ID" list="addsearchresult" onkeyup="updateshowResult(this.value)">
					</div>
				  </div>
                  <br>
                  <div class="form-group row">
					<label for="inputEmail3" class="col-sm-2 col-form-label">Software Version  :</label>
					<br><br>
					<div class="col-sm-3">
						<select  class="form-control" name="Update_Software_Version" id="Update_Software_Version">
                            <option value="Default">Default</option>
                        </select>
					 
					</div>
				   
				  </div>
				
				 
				  
			   <br>
			  
				 
				  <div class="text-center">
					<input type="submit" value="Submit" class="btn btn-primary" >
	
				   </div>
				</form>
			
	</div>
	<div class="modalform-footer">
		
	</div>
  
  </div>

  	<!-- The Modal -->
<div id="deleteform" class="modalform">

	<!-- Modal content -->
	<div class="modalform-header">
	  <span onclick="closeformdelete()" class="closeform">&times;</span>
	 <h1 class="text-center">Delete Software User</h1>
	</div>
	<div class="modalform-content">
		<div style="display: none">
        <input type="text" name="pkdelete" id="pkdelete"></div>
			   
                <div class="d-flex justify-content-between">
                    <button class="btn btn-primary" onclick="deleteitem()">Delete</button>
                    <button class="btn btn-primary" onclick="closedeleteform()">Cancel</button>
                </div>
                  
				
				  
			
	</div>
	<div class="modalform-footer">
		
	</div>
  
 






</div>
  
<div id="exportdata" class="modalform">

	<!-- Modal content -->
	<div class="modalform-header">
	  <span onclick="closeexportdata()" class="closeform">&times;</span>
	 <h1 class="text-center">Export data</h1>
	</div>
	<div class="modalform-content">
		<form method="POST" class="post-form" id="exportdata" onsubmit="exportdata(); return false">  
			{% csrf_token %}
			   
			<h3 class="text-center" style=" color: #564953;">Export data User Software Details</h3>
			<div>
				<div class="form-check form-check-inline" style="padding-left: 2.5em;">
					<input class="form-check-input" type="radio" name="inlineRadioOptions" id="allselect" value="all" onchange="openexport();" checked>
					<label class="form-check-label" for="inlineRadio1">All Selection</label>
				  </div>

				  
				<div class="form-check form-check-inline" style="padding-left: 7.5em;">
					<input class="form-check-input" type="radio" name="inlineRadioOptions" id="customselect" value="custom" onchange="customexport();">
					<label class="form-check-label" for="inlineRadio1">Custom Selection</label>
				  </div>
				<div class="form-group form-check-inline" style="padding-left: 3.5em;">
					<label for="inputEmail3" class="col-sm-2 col-form-label">Software Name </label>
				
					<select class="form-control" required name="export_softwarename" id="export_softwarename" onchange="Searchcustomexport()" disabled>
						  <option value="default">Default</option>
					
						
  
					
					</select>
				 
				  </div>
				  <!-- 
				<div class="form-group form-check-inline" >
					<label class="form-check-label" for="inlineRadio1">Custom Selection End</label>
					<div class="col-sm-3">
					 <input type="text" class="" name="customselectEnd" id="customselectEnd" >
					</div>
				  </div>
				  <div class="form-group form-check-inline" >
					<button type="button" id="SelectexportBTN" onclick="Searchcustomexport()" class="btn btn-primary">Search</button>
				  </div>
				</div> -->
<br>
			   <!-- <div class="text-center">
				<div class="input-group flex-nowrap">
					<span class="input-group-text" id="addon-wrapping">Hardware Type</span>
					<select class="form-control" required name="Network_Hardware_Type_export" id="Network_Hardware_Type_export" onchange="exporttypehardware()">
						<option value="All">All</option>
					  <option value="AP">Access Point</option>
					  <option value="CCTV">CCTV Camera</option>
					  <option value="CCTV_DVR">CCTV DVR</option>
					  <option value="CP">Conference Phone</option>
					  <option value="Door_Access">Door Access</option>
					  <option value="Switches">Switches</option>
					  <option value="Tape_Library">Tape Library</option>
					  <option value="Wireless_Dongle">Wireless Dongle</option>
					  <option value="Server">Server</option>
					 
					  <option value="UPS">UPS</option>
					  <option value="Firewall">Firewall</option>
				  </select>
				  </div>
			
			   </div> -->
			   
			
			<br>
		
			<h3 class="text-center" style=" color: #564953;">Expected Output</h3>
			<br>
			<div class="text-center">
				<button type="button" id="SelectexportBTN" onclick="downloadexport()" class="btn btn-primary">download</button>
			</div>
			<br>
			<div class="table-responsive " style="height: 400px;">
				<table class="table" id="computertable">
					<thead class="table-dark" id="computer-list">
					  <tr id="TRexport">
						
						<th scope="col">Software Type</th>
						<th scope="col">Software Name</th>
						<th scope="col">User Type</th>
						<th scope="col">Employee Number</th>
						<th scope="col">Software Version</th>
					
						

						
					  </tr>
					</thead>
					
					<tbody id="exportdataTD">
					
					

					
					  
					</tbody>
				  </table>
				</div>
			 
	</div>
	<div class="modalform-footer">
		
	</div>
  
  </div>




{% block javascript %}
  <script>
$(document).ready(function() {
		$.ajax({
			type: 'Get',
			cache: false,
			url: "{% url 'getsoftwaredata' %}",
		
			success: function(response){
				
				$(trtable).empty();
				for (var item in response.data){
					var tr = document.createElement("tr");
						var td1 = document.createElement("td");
						td1.innerHTML =response.data[item].Software_Type;
						var td2 = document.createElement("td");
						td2.innerHTML =response.data[item].Software_Name;
                        var td3 = document.createElement("td");
						td3.innerHTML =response.data[item].User_Type;
						var td4 = document.createElement("td");
						td4.innerHTML =response.data[item].User_ID;
						var td5 = document.createElement("td");
						td5.innerHTML =response.data[item].Software_Version;
					
						var td6 = document.createElement("td");
						var btnupdate = document.createElement("Button");
						btnupdate.id= response.data[item].id;
						btnupdate.classList.add("btn");
						btnupdate.classList.add("btn-primary");
						btnupdate.innerHTML="Update";
						btnupdate.addEventListener( "click", function() {
							datatoUform(this.id)
						
						});
                        var td7 = document.createElement("td");
						var btndelete = document.createElement("Button");
						btndelete.id= response.data[item].id;
						btndelete.classList.add("btn");
						btndelete.classList.add("btn-primary");
						btndelete.innerHTML="Delete";
						btndelete.addEventListener( "click", function() {
							opendeleteprompt(this.id)
						
						});
						var role =  "{{Style}}";
						if(role == "display:none"){
							btnupdate.disabled =true;
							btndelete.disabled =true;

						}
						else{
							btnupdate.disabled =false;
							btndelete.disabled =false;
						}
						td6.append(btnupdate);
						td7.append(btndelete);

						tr.append(td1);
						tr.append(td2);
						tr.append(td3);
						tr.append(td4);
						tr.append(td5);
						tr.append(td6);
                        tr.append(td7);
						
					
						$(trtable).append(tr);
                       
						
				}
                var arraylist = [];
                        for (var y in response.softwarename){
                            arraylist.push(response.softwarename[y].Software_name)
                        }
                        result = removeDuplicates(arraylist); 
                       for (var i in result){
                           var option = document.createElement("option");
                           option.value = result[i];
                           option.innerHTML =  result[i];
                           document.getElementById('softwarefilter').append(option);
						  
                       }
					   for (var y in result){
                           var option = document.createElement("option");
                           option.value = result[y];
                           option.innerHTML =  result[y];
                           document.getElementById('export_softwarename').append(option);
						  
                       }
					   
				var role =  "{{Style}}";
				if(role == "display:none"){
					document.getElementById('Add').disabled =true;

				}
				else{
					document.getElementById('Add').disabled =false;
				}

			
			
				
			}
		});


	
});	
function showResult(str) {
	const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

  if (str.length==0) {
    document.getElementById("searchIDresult").innerHTML="";
    document.getElementById("searchIDresult").style.border="0px";
    return;
  }
  if(document.getElementById("User_type_machine").checked == true){
	  if(str.includes("UTM-PC")){
		$.ajax({
			type: 'POST',
			headers: {'X-CSRFToken': csrftoken},
        	mode: 'same-origin', // Do not send CSRF token to another domain.
			url: "{% url 'searchUserinput' %}",
			data :{
				'User_ID': str,
				'Type' : "PC"
			

			}, 
			success: function(response){
				console.log(response);
				$(addsearchresult).empty();
				var y =  document.getElementById('addsearchresult');

				
				if(response.data.length > 0){
					for (var item in response.data){
                    var option = document.createElement('option');
                    option.id = response.data[item].computer_id;

                    option.innerHTML = response.data[item].computer_id;
					option.addEventListener("click",function() {
						clicksearchoption(this.id)
						
						}); 
						y.append(option);

                    
                }
			

				}
				else{
					var btn = document.createElement('span');
                    btn.innerHTML = "There were no id based on the input";
                    y.append(btn);
				}
              

				

			}
		});
	  }
	  if(str.includes("UTM-NB")){
		$.ajax({
			type: 'POST',
			headers: {'X-CSRFToken': csrftoken},
        	mode: 'same-origin', // Do not send CSRF token to another domain.
			url: "{% url 'searchUserinput' %}",
			data :{
				'User_ID': str,
				'Type' : "Laptop"
			

			}, 
			success: function(response){
				console.log(response);
				$(addsearchresult).empty();
				var y =  document.getElementById('addsearchresult');
			
				if(response.data.length > 0){
					for (var item in response.data){
                    var option = document.createElement('option');
                    option.id = response.data[item].computer_id;

                    option.innerHTML = response.data[item].computer_id;
					option.addEventListener("click",function() {
						clicksearchoption(this.id)
						
						}); 
					
                    y.append(option);
                }
				
				}
				else{
					var btn = document.createElement('span');
                    btn.innerHTML = "There were no id based on the input";
                    y.append(btn);
				}
              

				

			}
		});
	  }
  }
  else{
	  
	$.ajax({
			type: 'POST',
			headers: {'X-CSRFToken': csrftoken},
        	mode: 'same-origin', // Do not send CSRF token to another domain.
			url: "{% url 'searchUserinput' %}",
			data :{
				'User_ID': str,
				'Type' : "Employee"
			

			}, 
			success: function(response){
				console.log(response);
				$(addsearchresult).empty();
				var y =  document.getElementById('addsearchresult');
				if(response.data.length > 0){
					for (var item in response.data){
                    var option = document.createElement('option');
                    option.id = response.data[item].employee_number;

                    option.innerHTML = response.data[item].employee_number;
					option.addEventListener("click",function() {
						clicksearchoption(this.id)
						
						}); 
                    y.append(option);

                    
                }
				}
				else{
					var option = document.createElement('option');
                    option.innerHTML = "There were no id based on the input";
                    y.append(option);
				}
              

				

			}
		});
  }


}

function updateshowResult(str) {
	const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

  if (str.length==0) {
    document.getElementById("searchIDresult").innerHTML="";
    document.getElementById("searchIDresult").style.border="0px";
    return;
 	 }
  	if(document.getElementById("Update_User_type_machine").checked == true){
	  if(str.includes("UTM-PC")){
		$.ajax({
			type: 'POST',
			headers: {'X-CSRFToken': csrftoken},
        	mode: 'same-origin', // Do not send CSRF token to another domain.
			url: "{% url 'searchUserinput' %}",
			data :{
				'User_ID': str,
				'Type' : "PC"
			

			}, 
			success: function(response){
				console.log(response);
				$(addsearchresult).empty();
				var y =  document.getElementById('addsearchresult');

				
				if(response.data.length > 0){
					for (var item in response.data){
                    var option = document.createElement('option');
                    option.id = response.data[item].computer_id;

                    option.innerHTML = response.data[item].computer_id;
					option.addEventListener("click",function() {
						clicksearchoption(this.id)
						
						}); 
						y.append(option);

                    
                }
			

				}
				else{
					var btn = document.createElement('span');
                    btn.innerHTML = "There were no id based on the input";
                    y.append(btn);
				}
              

				

			}
		});
	  }
	  if(str.includes("UTM-NB")){
		$.ajax({
			type: 'POST',
			headers: {'X-CSRFToken': csrftoken},
        	mode: 'same-origin', // Do not send CSRF token to another domain.
			url: "{% url 'searchUserinput' %}",
			data :{
				'User_ID': str,
				'Type' : "Laptop"
			

			}, 
			success: function(response){
				console.log(response);
				$(addsearchresult).empty();
				var y =  document.getElementById('addsearchresult');
			
				if(response.data.length > 0){
					for (var item in response.data){
                    var option = document.createElement('option');
                    option.id = response.data[item].computer_id;

                    option.innerHTML = response.data[item].computer_id;
					option.addEventListener("click",function() {
						clicksearchoption(this.id)
						
						}); 
					
                    y.append(option);
                }
				
				}
				else{
					var btn = document.createElement('span');
                    btn.innerHTML = "There were no id based on the input";
                    y.append(btn);
				}
              

				

			}
		});
	  }
  }
  else{
	  
	$.ajax({
			type: 'POST',
			headers: {'X-CSRFToken': csrftoken},
        	mode: 'same-origin', // Do not send CSRF token to another domain.
			url: "{% url 'searchUserinput' %}",
			data :{
				'User_ID': str,
				'Type' : "Employee"
			

			}, 
			success: function(response){
				console.log(response);
				$(addsearchresult).empty();
				var y =  document.getElementById('addsearchresult');
				if(response.data.length > 0){
					for (var item in response.data){
                    var option = document.createElement('option');
                    option.id = response.data[item].employee_number;

                    option.innerHTML = response.data[item].employee_number;
					option.addEventListener("click",function() {
						clicksearchoption(this.id)
						
						}); 
                    y.append(option);

                    
                }
				}
				else{
					var option = document.createElement('option');
                    option.innerHTML = "There were no id based on the input";
                    y.append(option);
				}
              

				

			}
		});
  }


}


function clicksearchoption(idspan){
	var values = document.getElementById(idspan).innerHTML;
	var input = document.getElementById("User_ID");
	input.value = values;
	$(searchIDresult).empty();
}

function removeDuplicates(num) {
  var x,
      len=num.length,
      out=[],
      obj={};
 
  for (x=0; x<len; x++) {
    obj[num[x]]=0;
  }
  for (x in obj) {
    out.push(x);
  }
  return out;
}

function fitertable() {
  // Declare variables
  var input, filter, table, tr, td, i, txtValue;
  input = document.getElementById("softwarefilter").value;
  
  table = document.getElementById("softwareuser");
  tr = table.getElementsByTagName("tr");
console.log(input)
  // Loop through all table rows, and hide those who don't match the search query
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[1];
    if (td) {
      txtValue = td.textContent || td.innerText;
      if (txtValue.indexOf(input) > -1) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }
  }
}

function listsoftware(){
    var x = document.getElementById('Software_Type').value;
	const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

    $.ajax({
			type: 'POST',
			headers: {'X-CSRFToken': csrftoken},
        	mode: 'same-origin', // Do not send CSRF token to another domain.
			url: "{% url 'software_listing' %}",
			data :{
				'software_type': x
			

			}, 
			success: function(response){
				$(Software_Name).empty();
				var y =  document.getElementById('Software_Name');
				var option = document.createElement('option');
                    option.value = "Default";
                    option.innerHTML = "Default";
                    y.append(option);
				var datalist = new Set();
				for (var key in response.data){
					datalist.add(response.data[key].Software_name);
				}
			
				datalist.forEach (function(value) {
					console.log(value);
                    var option = document.createElement('option');
                    option.value = value;
                    option.innerHTML = value;
                    y.append(option);
                    console.log(value);
					
					})
               
				

			}
		});

}


function listsoftwareVersion(){
    var x = document.getElementById('Software_Name').value;
	const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

    $.ajax({
			type: 'POST',
			headers: {'X-CSRFToken': csrftoken},
        	mode: 'same-origin', // Do not send CSRF token to another domain.
			url: "{% url 'softwareVersion_listing' %}",
			data :{
				'Software_Name': x
			

			}, 
			success: function(response){
				$(Software_Version).empty();
				var y =  document.getElementById('Software_Version');
				var datalist = new Set();
				for (var key in response.data){
					datalist.add(response.data[key].Software_version);
				}
			
				datalist.forEach (function(value) {
					console.log(value);
                    var option = document.createElement('option');
                    option.value = value;
                    option.innerHTML = value;
                    y.append(option);
                    console.log(value);
					
					})

				

			}
		});

}

function openform(){


		var modalform = document.getElementById('addform');
		modalform.style.display = 'block';

		document.getElementById("add-IP").reset();
	
		

		
		
	}

function UpdatelistsoftwareVersion(){
    var x = document.getElementById('Update_Software_Name').value;
	const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

    $.ajax({
			type: 'POST',
			headers: {'X-CSRFToken': csrftoken},
        	mode: 'same-origin', // Do not send CSRF token to another domain.
			url: "{% url 'softwareVersion_listing' %}",
			data :{
				'Software_Name': x
			

			}, 
			success: function(response){
				$(Update_Software_Version).empty();
				var y =  document.getElementById('Update_Software_Version');
				var datalist = new Set();
				for (var key in response.data){
					datalist.add(response.data[key].Software_name);
				}
			
				datalist.forEach (function(value) {
					console.log(value);
                    var option = document.createElement('option');
                    option.value = value;
                    option.innerHTML = value;
                    y.append(option);
                    console.log(value);
					
					})

				

			}
		});

}

function Updatelistsoftware(){
    var x = document.getElementById('Update_Software_Type').value;
	const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

    $.ajax({
			type: 'POST',
			headers: {'X-CSRFToken': csrftoken},
        	mode: 'same-origin', // Do not send CSRF token to another domain.
			url: "{% url 'software_listing' %}",
			data :{
				'software_type': x
			

			}, 
			success: function(response){
				$(Update_Software_Name).empty();
				var y =  document.getElementById('Update_Software_Name');
				var datalist = new Set();
				for (var key in response.data){
					datalist.add(response.data[key].Software_name);
				}
			
				datalist.forEach (function(value) {
					console.log(value);
                    var option = document.createElement('option');
                    option.value = value;
                    option.innerHTML = value;
                    y.append(option);
                    console.log(value);
					
					})
               
				

			}
		});

}


function AddSoftwareUser(){
		var Software_Type = document.getElementById('Software_Type').value;
		var Software_Name = document.getElementById('Software_Name').value;
		if(document.getElementById('User_type_machine').checked == true){
			var User_Type = document.getElementById('User_type_machine').value;
		}
		else{
			var User_Type = document.getElementById('User_type_worker').value;
		}
		
		var User_ID = $('input[name="User_ID"]').val().trim();
        var Software_Version = document.getElementById('Software_Version').value;
		if (Software_Type == "" ||Software_Type == "Default" ){
			alert("You can't pick default option in software type option");
		}
		else if (Software_Name == "" ||Software_Type == "Default" ){
			alert("You can't pick blank option in software name option");
		}
		else if (Software_Version == "" ||Software_Type == "Default" ){
			alert("You can't pick blank option in software version option");
		}
		else{
;
		const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
		$.ajax({
			type: 'POST',
			headers: {'X-CSRFToken': csrftoken},
        	mode: 'same-origin', // Do not send CSRF token to another domain.
			url: "{% url 'addUserSoftwareform' %}",
			data :{
				'Software_Type' : Software_Type, 'Software_Name' : Software_Name, 'User_Type' : User_Type,
				'User_ID' : User_ID,  'Software_Version':Software_Version
			

			}, 
			success: function(data){
				console.log(data);
				console.log("Success Post");
				updatetable();
				closeform();

				

			}
			
		});
		}

		
}
	
function datatoUform(btnid){

	const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

	$.ajax({
			type: 'POST',
			headers: {'X-CSRFToken': csrftoken},
        	mode: 'same-origin', // Do not send CSRF token to another domain.
			url: "{% url 'getSoftUserdataupdate' %}",
			data :{
				'id' : btnid,
			

			}, 
			success: function(data){
				var modalform = document.getElementById('updateformmodal');
				modalform.style.display = 'block';
                document.getElementById('update_user_pk').value = data.id ;
				
				document.getElementById('Update_Software_Type').value = data.Software_Type ;
                for(var item in data.listsoftware ){
                    var option = document.createElement('option');
                    option.value = data.listsoftware[item].Software_name;
                    option.innerHTML = data.listsoftware[item].Software_name;
                    document.getElementById('Update_Software_Name').append(option);

                }
				document.getElementById('Update_Software_Name').value = data.Software_Name ;
				if(data.User_Type == "Machine"){
					document.getElementById('Update_User_type_machine').checked = true;
				}
				else{
					document.getElementById('Update_User_type_worker').checked = true;
				}
				document.getElementById('Update_User_ID').value = data.User_ID ;
                for(var item in data.versionsoftware ){
                    var option2 = document.createElement('option');
                    option2.value = data.versionsoftware[item].Software_version;
                    option2.innerHTML = data.versionsoftware[item].Software_version;
                    document.getElementById('Update_Software_Version').append(option2);

                }
				document.getElementById('Update_Software_Version').value = data.Software_Version ;
				
				console.log(data);

				
				
			}
		});

}
function opendeleteprompt(btnid){
				var modalform = document.getElementById('deleteform');
				modalform.style.display = 'block';
				document.getElementById('update_user_pk').value = btnid;



}
function closedeleteform(){
	var modalform = document.getElementById('deleteform');
				modalform.style.display = 'none';
}
function deleteitem(){
    var btnid = document.getElementById('update_user_pk').value;
	const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

    $.ajax({
			type: 'POST',
			headers: {'X-CSRFToken': csrftoken},
        	mode: 'same-origin', // Do not send CSRF token to another domain.
			url: "{% url 'deleteSoftwareUser' %}",
			data :{
				'id' : btnid,
			

			}, 
			success: function(data){
               
                closedeleteform();
                updatetable()
			alert('Success Delete')

				
				
			}
		});

}


function updatetable(){
    $.ajax({
			type: 'Get',
			cache: false,
			url: "{% url 'getsoftwaredata' %}",
		
			success: function(response){
				console.log(response);
				$(trtable).empty();
				for (var item in response.data){
					var tr = document.createElement("tr");
						var td1 = document.createElement("td");
						td1.innerHTML =response.data[item].Software_Type;
						var td2 = document.createElement("td");
						td2.innerHTML =response.data[item].Software_Name;
                        var td3 = document.createElement("td");
						td3.innerHTML =response.data[item].User_Type;
						var td4 = document.createElement("td");
						td4.innerHTML =response.data[item].User_ID;
						var td5 = document.createElement("td");
						td5.innerHTML =response.data[item].Software_Version;
					
						var td6 = document.createElement("td");
						var btnupdate = document.createElement("Button");
						btnupdate.id= response.data[item].id;
						btnupdate.classList.add("btn");
						btnupdate.classList.add("btn-primary");
						btnupdate.innerHTML="Update";
						btnupdate.addEventListener( "click", function() {
							datatoUform(this.id)
						
						});
                        var td7 = document.createElement("td");
						var btndelete = document.createElement("Button");
						btndelete.id= response.data[item].id;
						btndelete.classList.add("btn");
						btndelete.classList.add("btn-primary");
						btndelete.innerHTML="Delete";
						btndelete.addEventListener( "click", function() {
							opendeleteprompt(this.id)
						
						});
						td6.append(btnupdate);
						td7.append(btndelete);

						tr.append(td1);
						tr.append(td2);
						tr.append(td3);
						tr.append(td4);
						tr.append(td5);
						tr.append(td6);
                        tr.append(td7);
						
					
						$(trtable).append(tr);
						
				}
				
				
			
			
				
			}
		});




}
 


function openexport(){
	
	$.ajax({
			type: 'Get',
			
			url: "{% url 'getsoftwaredata' %}",
		
			success: function(response){
				document.getElementById("exportdata").style.display = 'block';
				document.getElementById('export_softwarename').disabled = true;

				
				$(exportdataTD).empty();
				for (var item in response.data){
					var tr = document.createElement("tr");
						var td1 = document.createElement("td");
						td1.innerHTML =response.data[item].Software_Type;
						var td2 = document.createElement("td");
						td2.innerHTML =response.data[item].Software_Name;
                        var td3 = document.createElement("td");
						td3.innerHTML =response.data[item].User_Type;
						var td4 = document.createElement("td");
						td4.innerHTML =response.data[item].User_ID;
						var td5 = document.createElement("td");
						td5.innerHTML =response.data[item].Software_Version;
						
						
					
						tr.append(td1);
						tr.append(td2);
						tr.append(td3);
						tr.append(td4);
						tr.append(td5);
						
						$(exportdataTD).append(tr);
						
				}
			

				
				
			
			
				
			}
		});
}

function customexport(){
	document.getElementById('export_softwarename').disabled = false;
	
}

function Searchcustomexport(){
	

		var softwarename = document.getElementById("export_softwarename").value;
	
		if((softwarename == "default")){
			alert("Fill the box first");
		}
		else
		{
				
				const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
				
				$.ajax({
					type: 'POST',
					headers: {'X-CSRFToken': csrftoken},
					mode: 'same-origin', // Do not send CSRF token to another domain.
					url: "{% url 'getcustomsoftwaredata' %}",
					data : { 'SoftwareName': softwarename}, 
					
					success: function(response){
						console.log(response);
						$(exportdataTD).empty();
				for (var item in response.data){
					var tr = document.createElement("tr");
						var td1 = document.createElement("td");
						td1.innerHTML =response.data[item].Software_Type;
						var td2 = document.createElement("td");
						td2.innerHTML =response.data[item].Software_Name;
                        var td3 = document.createElement("td");
						td3.innerHTML =response.data[item].User_Type;
						var td4 = document.createElement("td");
						td4.innerHTML =response.data[item].User_ID;
						var td5 = document.createElement("td");
						td5.innerHTML =response.data[item].Software_Version;
						
						
					
						tr.append(td1);
						tr.append(td2);
						tr.append(td3);
						tr.append(td4);
						tr.append(td5);
			
						
						$(exportdataTD).append(tr);
						
				}
				

		
		
	}
});
}
					
		}

function closeexportdata(){
	document.getElementById("exportdata").style.display = 'none';
}

function downloadexport(){
	const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

	if(document.getElementById("allselect").checked == true){
	type = 'all';

	$.ajax({
					type: 'POST',
					headers: {'X-CSRFToken': csrftoken},
					mode: 'same-origin', // Do not send CSRF token to another domain.
					url: "{% url 'exportsoftwaredataNetwork' %}",
					data : {'type': type}, 
					
					success: function(response){
						download_csv(response)

					

		
		
	}
});

}
else{
	type = 'custom';
	var softwarename = document.getElementById("export_softwarename").value;
		
		if((softwarename == "default")){
			alert("Fill the box first");
		}
		else
		{
			
			$.ajax({
					type: 'POST',
					headers: {'X-CSRFToken': csrftoken},
					mode: 'same-origin', // Do not send CSRF token to another domain.
					url: "{% url 'exportsoftwaredataNetwork' %}",
					data : {'type': type, 'SoftwareName':softwarename}, 
					
					success: function(response){
						download_csv(response)

					

		
		
	}
});

	
}
}
}
function download_csv(dataexport) {

    var headercsv  = ['Software Type', 'Software Name', 'User Type', 'Employee Number', 'Software Version'];
	let header = headercsv.join(',') + '\n';
	let csv = header;
	var data = dataexport.data;
	console.log(dataexport)
	console.log(data);
	data.forEach( obj => {
                let row = [];
                for (key in obj) {
                    if (obj.hasOwnProperty(key)) {
                        row.push(obj[key]);
                    }
                }
                csv += row.join(',')+"\n";
            });
		
    
    var hiddenElement = document.createElement('a');
    hiddenElement.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
    hiddenElement.target = '_blank';
    hiddenElement.download = 'Software User data.csv';
    hiddenElement.click();
}
 


function UpdatesoftwareUser(){
	var id = document.getElementById('update_user_pk').value;
	var Software_Type = document.getElementById('Update_Software_Type').value;
		var Software_Name = document.getElementById('Update_Software_Name').value;
		if(document.getElementById('Update_User_type_machine').checked == true){
			var User_Type = document.getElementById('Update_User_type_machine').value;
		}
		else{
			var User_Type = document.getElementById('Update_User_type_worker').value;
		}
		
		var User_ID = $('input[name="Update_User_ID"]').val().trim();
        var Software_Version = document.getElementById('Update_Software_Version').value;
		const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
		if (Software_Type == "" ||Software_Type == "Default" ){
			alert("You can't pick default option in software type option");
		}
		else if (Software_Name == "" ||Software_Type == "Default" ){
			alert("You can't pick blank option in software name option");
		}
		else if (Software_Version == "" ||Software_Type == "Default" ){
			alert("You can't pick blank option in software version option");
		}
		else{
		$.ajax({
			type: 'POST',
			headers: {'X-CSRFToken': csrftoken},
        	mode: 'same-origin', // Do not send CSRF token to another domain.
			url: "{% url 'updateformsoftwareUser' %}",
			data :{
				'Software_Type' : Software_Type, 'Software_Name' : Software_Name, 'User_Type' : User_Type,'User_ID' : User_ID,
				'Software_Version' : Software_Version, 'id' : id,
			}, 
			success: function(data){
				console.log(data);
				console.log("Success Post");
				updatetable();
				closeformupdate();

				

			}
		});
		}

		
}
 </script>
  {% endblock javascript %}
	<script src="{% static 'js/app.js' %}"></script>
	<script src="{% static 'js/open form modal.js' %}"></script>
	<script src="{% static 'js/computeradd.js' %}"></script>


</body>

</html>